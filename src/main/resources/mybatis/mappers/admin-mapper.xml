<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.toy.admin.mapper.AdminMapper">

	<sql id="userColumns">
		USER_NO
		, USER_ID
		, USER_EMAIL
		, USER_NICKNAME
		, PROVIDER
		, ROLE
		, I_DATE
	</sql>

	<select id="selectAuthModel" resultType="AdminDTO">
		/* com.project.toy.admin.dto.AdminDTO */
		
		SELECT MODEL_NAME FROM T_AUTH_MODEL WHERE USE_YN = 'Y'
	</select>
	
	<select id="selectAuthUser" resultType="AdminDTO">
		SELECT B.USER_ID, A.MODEL_NAME
		FROM   T_AUTH_MODEL A
		LEFT OUTER JOIN T_PERSON B ON A.MODEL_NAME = B.ROLE
		WHERE  1=1
		AND    A.USE_YN = 'Y'
		AND    B.USER_NO = #{ value }
	</select>
	
	<select id="selectListUser" resultType="AdminDTO">
		/* com.project.toy.user.dto.UserDTO */
		
		SELECT USER_NO 			AS userNo
		     , USER_ID 			AS userId
		     , USER_EMAIL 		AS userEmail
		     , USER_NICKNAME 	AS userNickname
		     , PROVIDER			AS provider
		     , ROLE				AS role
		     , I_DATE			AS IDate
		FROM   toy.T_PERSON
		WHERE  1=1
		AND    USE_YN = 'Y'
		ORDER BY USER_NO DESC
	</select>
	
	<!-- 상세보기 -->
	<select id="findByUserId" resultType="AdminDTO">
		/* com.project.toy.admin.dto.AdminDTO */
		
		SELECT <include refid="userColumns" />
		FROM   T_PERSON
		WHERE  1=1
		AND    USER_NO = #{ value }
	</select>
	
	<!-- 커뮤니티 게시글 리스트 -->
	<select id="findByBoardIdAndCommunity" resultType="BoardResponseDTO">
		SELECT B.ID
		     , B.BOARD_SEQ
		     , B.TITLE
		     , B.DELETE_YN
		     , B.I_DATE
		FROM   BOARD B
		     , T_PERSON A
		WHERE  1=1
		AND    B.WRITER_ID = A.USER_ID
		AND    B.BOARD_SEQ = '1'
		AND    B.DELETE_YN = '0'
		AND    A.USER_NO = #{ id }
	</select>
	
	<!-- 리뷰 게시글 리스트 -->
	<select id="findByBoardIdAndReview" resultType="BoardResponseDTO">
		SELECT B.ID
		     , B.BOARD_SEQ
		     , B.TITLE
		     , B.DELETE_YN
		     , B.I_DATE
		FROM   BOARD B
		     , T_PERSON A
		WHERE  1=1
		AND    B.WRITER_ID = A.USER_ID
		AND    B.BOARD_SEQ = '2'
		AND    B.DELETE_YN = '0'
		AND    A.USER_NO = #{ id }
	</select>
	
	<!-- 전체 댓글 리스트 -->
	
	
	<!-- 유저 수 카운팅 -->
	<select id="countUser" parameterType="SearchDTO" resultType="int">
		/* com.project.toy.common.dto.SearchDTO */
		
		SELECT COUNT(1)
		FROM   T_PERSON
		WHERE  1=1
		AND    USE_YN = 'Y'
	</select>
	
</mapper>