<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
				xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
				xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
				layout:decorate="~{layouts/layout}">

<head>
<meta charset="UTF-8">
<title>OYEZ - All That Community</title>

<th:block layout:fragment="css">
	<!-- RESET, DEFAULT -->
	<link rel="stylesheet" th:href="@{/css/app/reset.css}" />
	<link rel="stylesheet" th:href="@{/css/lib/bootstrap.min.css}" />
	<link rel="stylesheet" th:href="@{/css/app/index.css}" />
	<link rel="stylesheet" th:href="@{/css/app/default.css}" />
	<!-- POPUP -->
	<link rel="stylesheet" th:href="@{/css/app/popup.css}" />
</th:block>

</head>

<body>
	
	<!-- CONTENT -->
	<main layout:fragment="content" class="container">
		<div class="main">
			<img src="/img/upload/main_image.jpg" style="width: 75%">
		</div>
	</main>
	
	<th:block layout:fragment="script">
		<!-- FONT AWESOME -->
		<script type="text/javascript" src="/js/lib/fontawesome.js"></script>
		<!-- Jquery, Bootstrap -->
		<script type="text/javascript" src="/js/lib/jquery.min.js"></script>
		<script type="text/javascript" src="/js/lib/bootstrap.min.js"></script>
		<script type="text/javascript" src="/js/app/header.js"></script>
		<!-- SWEETALERT2 -->
		<script type="text/javascript" src="/js/lib/sweetalert2.js"></script>
		<!-- POPUP -->
		<script type="text/javascript" src="/js/lib/sockjs.min.js"></script>
		<script type="text/javascript" src="/js/lib/stomp.min.js"></script>
		<script type="text/javascript" src="/js/app/popup.js"></script>
		<script th:inline="javascript">
			if([[ ${role} ]] == 'GUEST') {
				swal.fire({
					title: '인증이 필요한 계정입니다.',
					text: '계정 인증 페이지로 이동할까요?',
					footer: '인증 후 OYEZ의 모든 콘텐츠 이용이 가능합니다.',
					icon: 'warning',
					showCancelButton: true,
					confirmButtonColor: '#3085d6',
					cancelButtonColor: '#d33',
					confirmButtonText: '이동',
					cancelButtonText: '취소'
				}).then((result) => {
					if(result.isConfirmed) {
						location.href = '/' + [[ ${userId} ]] + '/account';
					}
				});
			}
			
			/*
			const chat__create = document.getElementById('chat__create');
			const chat__room = document.getElementById('chat__room');
			
			chat__create.style.display = 'initial';
			chat__room.style.display = 'none';
			
			$('#listChatRoom').on('click', function() {
				chat__create.style.display = 'none';
				chat__room.style.display = 'initial';
			}
			*/
			
			$("#createChatRoom").on("click", function() {
				var roomId = [[ ${roomId} ]];
				var roomName = $("#roomName").val();
				console.log("roomId : " + roomId);
				console.log("roomName : " + roomName);
				
				
				$.ajax({
					url: "/chat/room",
					type: "POST",
					dataType: "JSON",
					data: { "name": roomName },
					success: function() {
						$("#chat__list-chatrooms").html(
			                `<div id="chat__list-chatrooms">` +
			                `<a>create Room!!</a>` +
			                `</div>`
			            );
						
						loadChatRoom();
					},
					error: function() {
						swal.fire({
							text: '잠시 후 재시도 바랍니다.',
							footer: '서버와의 통신 에러입니다.',
							icon: 'error',
							confirmButtonColor: '#3085d6',
							confirmButtonText: '확인'
						});
					}
				});
			});
			
			function loadChatRoom() {
				$("#chat__list-chatrooms").html("");
				
				var room = "success!!";
				console.log("room : " + room);
				
				$.ajax({
			        url: "/chat/room",
			        type: "GET",
			        data: {
			            room: room,
			        },
			        dataType: "TEXT",
			        success: function(result) {
			        	console.log("success : " + room);
			            // 채팅방 목록 갱신
			            $("#chat__list-chatrooms").html(
			                `<div id="chat__list-chatrooms">` +
			                `<a>` + room + `</a>` +
			                `</div>`
			            );
			        },
			        error: function() {
			        	console.log("fail");
			        }
				});
			}
		</script>
	</th:block>
	
</body>

</html>